# Wassertech CRM — Чек-поинт №1

## Кратко
Оффлайн-приложение для инженеров Wassertech. Позволяет вести базу клиентов, объектов, установок и компонентов систем водоподготовки, проводить техническое обслуживание (ТО) и сохранять данные локально в Room. Всё работает оффлайн, интерфейс на Jetpack Compose.

---

## Текущее состояние (Чек-поинт №1)
Полностью реализована архитектура приложения и логика работы с данными:
- Иерархия: Клиент → Объект → Установка → Компонент.
- Полный CRUD для всех сущностей.
- Шаблоны ТО создаются автоматически при первом запуске (TemplateSeeder).
- Экран проведения ТО с разворачивающимися компонентами и заполняемыми полями.
- Поддержка сортировки объектов, установок и компонентов вручную (стрелками ↑/↓).
- Навигация с TopAppBar, стрелкой «Назад» и субзаголовком (subnav).
- FAB-кнопки на ключевых экранах: «+ Клиент», «+ Объект», «+ Установка», «+ Компонент».
- Полная визуальная и функциональная согласованность.

---

## Архитектура и стек
- Kotlin 1.9.25 + Compose Compiler 1.5.15
- Compose BOM 2024.10.01 (Material 3)
- AGP 8.7.2, Gradle 8.13
- Room 2.6.1 + KSP 1.9.25-1.0.20
- Min SDK 26, targetSdk 36
- JDK 21

База данных Room содержит:
- Клиенты (`ClientEntity`, с полем `isCorporate`)
- Объекты (`SiteEntity`)
- Установки (`InstallationEntity`)
- Компоненты (`ComponentEntity`)
- Шаблоны ТО (`ChecklistTemplateEntity`, `ChecklistFieldEntity`)
- Сессии ТО (`MaintenanceSessionEntity`, `ObservationEntity`, `IssueEntity`)

---

## Структура пакетов

```
ui/
  clients/ — клиенты и объекты
  hierarchy/ — установки и компоненты
  maintenance/ — экраны ТО
  icons/ — AppIcons.kt
data/
  entities/, dao/, relations/, seed/, types/
viewmodel/
  HierarchyViewModel.kt
  MaintenanceViewModel.kt
```

---

## Основные экраны

### Клиенты (главная)
- Список клиентов (иконка Person/Factory).
- FAB «+ Клиент».
- Переход в экран клиента по клику на карточку.

### Клиент
- Заголовок с иконкой клиента и кнопкой «Редактировать» (под именем).
- Раскрывающиеся списки объектов, в каждом объекты → установки.
- FAB: «+ Объект» и «+ Установка» (с выбором объекта).
- Возможность сортировки объектов.

### Объект
- Заголовок с иконкой Warehouse и кнопкой «Редактировать».
- FAB «+ Установка».
- Возможность сортировки установок.

### Установка
- Заголовок с иконкой Lab Panel и кнопкой «Редактировать».
- Кнопки «Провести ТО» и «Изменить порядок».
- FAB «+ Компонент».
- Возможность сортировки компонентов.

### ТО установки
- Разворачивающиеся списки компонентов.
- Поля по шаблонам (checkbox / number / text).
- Сохранение сессии ТО и наблюдений.

---

## Что готово (чек-лист)
✅ Иерархия и CRUD  
✅ Сортировки (объекты, установки, компоненты)  
✅ Автоматические шаблоны ТО  
✅ Проведение ТО установки  
✅ Логотип и навигация с TopAppBar  
✅ Иконки Material3 (Person, Factory, Warehouse, Science, Brick)  
✅ FAB на всех уровнях  
✅ Диалоги редактирования  

---

## Что дальше (Чек-поинт №2)
1. История ТО по объектам и установкам.
2. Просмотр сессий и Issues.
3. Генерация мини-отчётов (PDF).
4. Экспорт/шаринг отчётов.
5. Редактор шаблонов.
6. Поддержка миграций Room v3+.
7. Подготовка к синхронизации с сервером.

---

## UX и принципы
- Переход всегда по карточке (не по кнопке «Открыть»).
- Стрелка «Назад» в TopAppBar обязательна.
- Sub-nav показывает, где мы находимся.
- Клиент может быть частный или корпоративный (по иконке).
- При малом числе установок всё можно вести через объект «Главный».
- Все кнопки и карточки во всю ширину, визуально унифицированы.

---

## Автор проекта
**Wassertech** — приложение для внутреннего использования инженерной службой.  
**Разработка и UX-дизайн:** Дмитрий Шульски (совместно с ChatGPT GPT‑5).

---
